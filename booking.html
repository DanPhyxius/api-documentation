<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musement API documentation</title>

    <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic'
          rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="http://musement.github.io/api-documentation/css/theme.css" type="text/css"/>
    <link rel="stylesheet" href="http://musement.github.io/api-documentation/css/theme-fixes.css" type="text/css"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
</head>
<body class="wy-body-for-nav">

    <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
            <div class="wy-side-nav-search">
                <a href="http://musement.github.io/api-documentation/" class="fa fa-home"> Musement API documentation</a>
            </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://musement.github.io/api-documentation/authentication.html">
                                Authentication
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://musement.github.io/api-documentation/catalog.html">
                                Catalog
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://musement.github.io/api-documentation/booking.html">
                                Booking
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://musement.github.io/api-documentation/search.html">
                                Search
                            </a>
                        </li>
                                    </ul>
            </div>
            &nbsp;
        </nav>

        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                        <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
                <a href="http://musement.github.io/api-documentation/">Musement API documentation</a>
            </nav>


                        <div class="wy-nav-content">
                <div class="rst-content">
                    <div role="main" class="document">
                        <h2 id="3-api-for-booking">3. API for Booking</h2>
<p><img src="http://musement.s3.amazonaws.com/documentation_images/booking.png" alt="Booking" /></p>
<p>For a successful booking you have to: </p>
<ol>
<li><code>GET /events/{id}</code></li>
<li><code>GET /events/{id}/dates</code></li>
<li><code>GET /events/{id}/dates/{YYYY-MM-DD}</code></li>
<li><code>POST /cart</code></li>
<li>Create the order</li>
<li>Finalize the order with or without payment (depending on your contract)</li>
<li>Retrieve the voucher</li>
</ol>
<h3 id="31-get-event">3.1 GET Event</h3>
<p>To navigate the catalog refer to [paragraph 2] (<a href="https://github.com/musement/api-documentation/blob/master/Catalog.md">https://github.com/musement/api-documentation/blob/master/Catalog.md</a>). </p>
<h3 id="32-get-available-dates-for-a-specific-event">3.2 Get available dates for a specific event</h3>
<p><strong>DOCs</strong>: [<a href="http://api.musement.com/documentation#get--api-v3-events-{id}-dates.{_format">http://api.musement.com/documentation#get--api-v3-events-{id}-dates.{_format</a>}]
(<a href="http://api.musement.com/documentation#get--api-v3-events-{id}-dates.{_format">http://api.musement.com/documentation#get--api-v3-events-{id}-dates.{_format</a>})</p>
<p>Returns a list of all days with availabitiy for a specific event over a period of time.</p>
<p>To specify the period you can use the parameters <code>from_date</code> and <code>end_date</code>. If none of this data parameters is specified <code>from_date</code> is set to the current day. If <code>end_date</code> is not specified then <code>end_date</code> is set same as <code>from_date</code></p>
<p><strong>Examples:</strong></p>
<p><strong><em> No parameters </em></strong> </p>
<p><code>from_date</code> and <code>end_date</code> are set as the current day. This call return the current date if there is availabitiy an empty array otherwise.</p>
<pre><code>GET /api/v3/events/497/dates
Authorization: Bearer HereTheBearerFromOauth</code></pre>
<p><strong><em> With parameters </em></strong> </p>
<p>Search for available dates for dicember 2016</p>
<pre><code>GET /api/v3/events/497/dates?from_date=2016-12-01&amp;end_date=2016-12-31
Authorization: Bearer HereTheBearerFromOauth</code></pre>
<p><strong>Example Response:</strong></p>
<p>The response is a collection of date</p>
<pre><code>[
  {
    "date": "2016-01-14"
  },
  {
    "date": "2016-01-25"
  }
]</code></pre>
<h3 id="33-tickets-available-for-a-specific-event-and-day">3.3 Tickets available for a specific event and day</h3>
<p>Return a list of all available tickets for a specific day. The response is a collection of items containing : </p>
<ul>
<li><code>datetime</code> - The date and time. For a single day an event can start more than once.</li>
<li><code>seats</code> - A collection of all available <code>seats</code>. Here the seat structure</li>
<li><code>open_ticket</code> - If true the event is an open ticket</li>
<li><code>availability</code> - Number of place avaialble</li>
<li><code>languages</code> - The event can be available in different language. Different time can have different languages</li>
</ul>
<p><code>seat</code> structure:</p>
<ul>
<li><code>id</code> - Unique seat identifier</li>
<li><code>price_tag</code> - Give info about the person the ticket is for. Ticket type (<code>name</code>) and type of person (<code>group</code>) the <code>seat</code> is for. Please note that for the same date and time the combination of <code>name</code> and <code>group</code>  is unique but you can have more seat with the same <code>group</code> or <code>name</code></li>
<li><code>max_buy</code> and <code>min_buy</code> - Maximum and minimum number of ticket buyiable in a single transaction</li>
<li><code>raw_price</code> and <code>retail_price</code> - Internal and public price</li>
</ul>
<p><code>GET /api/v3/events/497/dates/2016-01-15</code></p>
<p>Response</p>
<pre><code>[
  {
    "datetime": "2016-01-14T13:45:00+0000",
    "seats": [
      {
        "id": 8216618,
        "price_tag": {
          "name": "Full price",
          "group": "Tour",
          "locale": "en"
        },
        "max_buy": 15,
        "min_buy": 1,
        "raw_price": {
          "currency": "EUR",
          "value": 40,
          "formatted_value": "€ 40.00"
        },
        "retail_price": {
          "currency": "EUR",
          "value": 40,
          "formatted_value": "€ 40.00"
        }
      }
    ],
    "open_ticket": false,
    "availability": 9,
    "languages": [
      "en"
    ]
  }
]</code></pre>
<h3 id="34-cart-apis">3.4 Cart APIs</h3>
<p>Cart APIs are useful to check the amount of the order, add promotions and discounts and check ticket availability. Every time you add something to it we block the ticket and calculate the final price of the order.</p>
<h4 id="341-post-carts---create-a-new-cart">3.4.1 POST /carts - Create a new Cart</h4>
<p>DOCs: <a href="http://api.musement.com/documentation#post--api-v3-carts.{_format">http://api.musement.com/documentation#post--api-v3-carts.{_format</a>}</p>
<p>Check Documentation for Request Payload. </p>
<p>NB. The Product id is the SeatPrice id. </p>
<h4 id="342-get-cartid---retrive-the-cart">3.4.2 GET /cart/{id} - Retrive the cart</h4>
<h4 id="343-putpatch-cartid---to-update-the-cart">3.4.3 PUT/PATCH /cart/{id} - To Update the cart</h4>
<p>With this API you can update your cart, adding or removing tickets or populating it with customer info.
The main difference between PUT and PATCH is that with the first you will update the model of the cart with the body you send, with the PATCH you will update just the field you sent in body. </p>
<p>For example - in the cart: </p>
<pre><code>{
  "id": 1,
  "tickets": [
    {
      "product": {
        "id": "4488624",
        "type": "musement",
        "title": "Torre Eiffel: biglietti salta-la-coda con accesso sommità",
        "datetime": "2015-08-27T17:30:00+0000",
        "tourist_category": "Prezzo intero",
        "activity_name": "Ingresso",
        "event": {
          "id": 2700,
          "title": "Torre Eiffel: biglietti salta-la-coda con accesso sommità"
        },
        "image": "https://static1.musement.com/cover/0001/19/skip-the-line-tickets-to-the-eiffel-tower-with-summit-acc..."
      },
      "code": "BLU27-08-17-92138",
      "quantity": 1,
      "metadata": {},
      "status": "PENDING",
      "vouchers": []
    }
  ],
  "retail_price": {
    "currency": "EUR",
    "value": 26.6,
    "formatted_value": "€ 26.60"
  }
}</code></pre>
<p>If you PATCH it with this request:</p>
<pre><code>PATCH /cart/1
BODY:
{
  "customer" : {
        "email": "guest136a@fakemail.com",
        "firstname": "Guest136a",
        "lastname": "surname136a",
        "country": {
          "id": 123
        }
  }
}</code></pre>
<p>You will get the cart with the customer info <code>GET /cart/1</code>:</p>
<pre><code>{
  "id": 1,
  "tickets": [
    {
      "product": {
        "id": "4488624",
        "type": "musement",
        "title": "Torre Eiffel: biglietti salta-la-coda con accesso sommità",
        "datetime": "2015-08-27T17:30:00+0000",
        "tourist_category": "Prezzo intero",
        "activity_name": "Ingresso",
        "event": {
          "id": 2700,
          "title": "Torre Eiffel: biglietti salta-la-coda con accesso sommità"
        },
        "image": "https://static1.musement.com/cover/0001/19/skip-the-line-tickets-to-the-eiffel-tower-with-summit-acc..."
      },
      "code": "BLU27-08-17-92138",
      "quantity": 1,
      "metadata": {},
      "status": "PENDING",
      "vouchers": []
    },
    {
        "email": "guest136a@fakemail.com",
        "firstname": "Guest136a",
        "lastname": "surname136a",
        "country": {
          "id": 123,
          "name": "Nepal"
        }
    }
  ],
  "retail_price": {
    "currency": "EUR",
    "value": 26.6,
    "formatted_value": "€ 26.60"
  }
}</code></pre>
<p>Check, all original data is still there plus the new customer info.</p>
<h4 id="343-delete-cart---delete-the-cart">3.4.3 DELETE Cart - Delete the cart</h4>
<h4 id="344-customer-info-needed-for-cart">3.4.4 Customer Info needed for cart</h4>
<p>Docs: <a href="http://api.musement.com/documentation#get--api-v3-carts-{id}-form.{_format">http://api.musement.com/documentation#get--api-v3-carts-{id}-form.{_format</a>}</p>
<p>With this form you can retrieve all information needed for a successful booking, there are three big categories:</p>
<ul>
<li>Customer Data</li>
<li>Extended Fields</li>
<li>Passenger Info</li>
</ul>
<p>Customer Data and Extended Fields are related to the customer, Passenger info is related to each traveler.</p>
<p>Example:
Request: <code>GET /api/v3/carts/{id}/form</code>
Response:</p>
<pre><code>{
  "children": {
    "firstname": {
      "type": "text",
      "required": true,
      "label": "Name"
    },
    "lastname": {
      "type": "text",
      "required": true,
      "label": "Surname"
    },
    "email": {
      "children": {
        "email": {
          "type": "email",
          "required": true,
          "label": "Email Address"
        },
        "email_confirm": {
          "type": "email",
          "required": true,
          "label": "Confirm Email"
        }
      },
      "type": "repeated",
      "required": true,
      "label": "Email Address"
    },
    "customer_data": {
      "children": {
        "do_you_need_invoice": {
          "type": "checkbox",
          "required": false,
          "label": "Do you need an invoice?"
        },
        "birthdate": {
          "type": "date",
          "required": false,
          "label": "Date of birth"
        },
        "country": {
          "type": "entity",
          "required": true,
          "label": "Country"
        },
        "city": {
          "type": "text",
          "required": false,
          "label": "City"
        },
        "address": {
          "type": "text",
          "required": false,
          "label": "Address"
        },
        "zipcode": {
          "type": "text",
          "required": false,
          "label": "ZIP Code"
        },
        "mobile": {
          "type": "number",
          "required": false,
          "label": "Mobile #"
        },
        "id_number": {
          "type": "text",
          "required": false,
          "label": "text.profile.id_number"
        }
      },
      "type": "musement_user_customer_data",
      "required": true,
      "label": "text.profile.customer_data"
    },
    "extended_fields": {
      "children": {
        "2700": {
          "children": {
            "159": {
              "children": {
                "phone_number": {
                  "type": "text",
                  "required": true,
                  "label": "Phone number"
                }
              },
              "type": "form",
              "required": true,
              "label": "text.profile.159"
            }
          },
          "type": "form",
          "required": true,
          "label": "text.profile.2700"
        }
      },
      "type": "form",
      "required": true,
      "label": "text.profile.extended_fields"
    }
  }
}</code></pre>
<p>Just required fields are needed for a successful booking. With a response like the previous one you have to Update your cart with this body:</p>
<pre><code>{
        "firstname": "Guest136a",
        "lastname": "surname136a",
        "email": "guest136a@fakemail.com",
        "customer_data": 
        {
                "country": {
                  "id": 123,
                  "name": "Nepal"
                }
        },
        "extended_fields": {
                "phone_number": 123
        }
}</code></pre>
<h3 id="35-create-the-order">3.5 Create the order</h3>
<p>When the cart is completed (<strong>with customer info filled in</strong>) and you want to finalize it (proceed with payments and check the availability one last time) </p>
<p><code>POST /api/v3/order</code></p>
<h3 id="36-finalize-the-order">3.6 Finalize the order</h3>
<p>If the order amount is equal to 0 or you use your payment gateway, use the flow without payment (ask for activation). Otherwise follow the Payment flow in 4.4.2.</p>
<h4 id="361-without-payment-flow">3.6.1 Without Payment Flow</h4>
<p>Request <code>POST /api/v3/payments/no-payment</code></p>
<h4 id="362-with-payment-flow">3.6.2 With Payment Flow</h4>
<h5 id="braintree-payments">Braintree Payments</h5>
<p>You have to integrate Braintree SDK</p>
<p>Note: in QA endpoint use credit card numbers contained in this link <a href="https://developers.braintreepayments.com/reference/general/testing/ruby#credit-card-numbers">https://developers.braintreepayments.com/reference/general/testing/ruby#credit-card-numbers</a> </p>
<h6 id="step-1">Step 1</h6>
<p>GET the token</p>
<p>Request <code>POST /api/v3/payments/braintree/token</code>
Response <code>{ "nonce": "eyJ2ZXJzaW9uIjoyLCJhdXRob3JpemF0aW9uRmluZ2VycHJpbnQiOiI3MDVjY2JlZThmZDRkNzI3MWQ2NTJjZDVjOTZjZDAyOTA5YWEzZDA4ZTJhN2ExNDVlNzc3MTI3MWYxMTUzMDIxfGNyZWF0ZWRfYXQ9MjAxNi0wMi0wM1QxMzowNzowOS43NjQ5NDQ2NjIrMDAwMFx1MDAyNm1lcmNoYW50X2lkPXE5MjdzdGt5cjRtZHc1MnhcdTAwMjZwdWJsaWNfa2V5PWNzMjJkMjJzbjc2ano4YzYiLCJjb25maWdVcmwiOiJodHRwczovL2FwaS5icmFpbnRyZWVnYXRld2F5LmNvbTo0NDMvbWVyY2hhbnRzL3E5MjdzdGt5cjRtZHc1MngvY2xpZW50X2FwaS92MS9jb25maWd1cmF0aW9uIiwiY2hhbGxlbmdlcyI6WyJjdnYiXSwiZW52aXJvbm1lbnQiOiJwcm9kdWN0aW9uIiwiY2xpZW50QXBpVXJsIjoiaHR0cHM6Ly9hcGkuYnJhaW50cmVlZ2F0ZXdheS5jb206NDQzL21lcmNoYW50cy9xOTI3c3RreXI0bWR3NTJ4L2NsaWVudF9hcGkiLCJhc3NldHNVcmwiOiJodHRwczovL2Fzc2V0cy5icmFpbnRyZWVnYXRld2F5LmNvbSIsImF1dGhVcmwiOiJodHRwczovL2F1dGgudmVubW8uY29tIiwiYW5hbHl0aWNzIjp7InVybCI6Imh0dHBzOi8vY2xpZW50LWFuYWx5dGljcy5icmFpbnRyZWVnYXRld2F5LmNvbSJ9LCJ0aHJlZURTZWN1cmVFbmFibGVkIjpmYWxzZSwicGF5cGFsRW5hYmxlZCI6dHJ1ZSwicGF5cGFsIjp7ImRpc3BsYXlOYW1lIjoiTXVzZW1lbnQiLCJjbGllbnRJZCI6IkFkcTdxSTJrS2NNTEFIQjRGRDRac1JxNC13VGp0eUxnckhRdllSTGMtQ1k0MGFmZlh2dUYwUHpLRUJSSVZfRktJeTVaNmJvREZpY1A2ZmIzIiwicHJpdmFjeVVybCI6Imh0dHBzOi8vd3d3Lm11c2VtZW50LmNvbS9lbi9wL3ByaXZhY3kiLCJ1c2VyQWdyZWVtZW50VXJsIjoiaHR0cHM6Ly93d3cubXVzZW1lbnQuY29tL2VuL3AvdGVybXMtY29uZGl0aW9ucyIsImJhc2VVcmwiOiJodHRwczovL2Fzc2V0cy5icmFpbnRyZWVnYXRld2F5LmNvbSIsImFzc2V0c1VybCI6Imh0dHBzOi8vY2hlY2tvdXQucGF5cGFsLmNvbSIsImRpcmVjdEJhc2VVcmwiOm51bGwsImFsbG93SHR0cCI6ZmFsc2UsImVudmlyb25tZW50Tm9OZXR3b3JrIjpmYWxzZSwiZW52aXJvbm1lbnQiOiJsaXZlIiwidW52ZXR0ZWRNZXJjaGFudCI6ZmFsc2UsImJyYWludHJlZUNsaWVudElkIjoiQVJLcllSRGgzQUdYRHpXN3NPXzNiU2txLVUxQzdIR191V05DLXo1N0xqWVNETlVPU2FPdElhOXE2VnBXIiwiYmlsbGluZ0FncmVlbWVudHNFbmFibGVkIjpmYWxzZSwibWVyY2hhbnRBY2NvdW50SWQiOiJtdXNlbWVudEVVUiIsImN1cnJlbmN5SXNvQ29kZSI6IkVVUiJ9LCJjb2luYmFzZUVuYWJsZWQiOmZhbHNlLCJtZXJjaGFudElkIjoicTkyN3N0a3lyNG1kdzUyeCIsInZlbm1vIjoib2ZmIiwiYXBwbGVQYXkiOnsic3RhdHVzIjoicHJvZHVjdGlvbiIsImNvdW50cnlDb2RlIjoiVVMiLCJjdXJyZW5jeUNvZGUiOiJFVVIiLCJtZXJjaGFudElkZW50aWZpZXIiOiJtZXJjaGFudC5jb20ubXVzZW1lbnQubXVzZW1lbnRwcm9kIiwic3VwcG9ydGVkTmV0d29ya3MiOlsidmlzYSIsIm1hc3RlcmNhcmQiXX18" }</code></p>
<h6 id="step-2">Step 2</h6>
<p>Using Braintree SDK, ask the user for payment information (credit card, paypal etc). For more details please visit: <a href="https://developers.braintreepayments.com/">https://developers.braintreepayments.com/</a></p>
<h6 id="step-3">Step 3</h6>
<p>After the user fills out the braintree payment form, ask us to process the payment and close the order </p>
<p>Request <code>POST /api/v3/payments/braintree/payment</code></p>
<p>Request Body </p>
<pre><code>{
  "nonce" : "nonce_text",
  "orderId" : 123456
}</code></pre>
<h3 id="37-retrieve-the-voucher">3.7 Retrieve the voucher</h3>
<p>If you used the login 2.1.2 you can retrieve the voucher with the Request</p>
<p><code>GET /customer/me/orders</code></p>
<p>Otherwise we will send it to your email address.</p>
                    </div>

                    <footer>
                        <hr/>
                                                Built with <a href="http://couscous.io/">Couscous</a> using a <a href="https://github.com/CouscousPHP/Template-ReadTheDocs">theme</a> based on <a href="https://readthedocs.org/">Read the Docs</a>.
                    </footer>

                </div>
            </div>

        </section>

    </div>

    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script src="http://musement.github.io/api-documentation/js/theme.js"></script>

    <script>
        $(function() {
            // Syntax highlighting
            hljs.initHighlightingOnLoad();
        });
    </script>

</body>
</html>
