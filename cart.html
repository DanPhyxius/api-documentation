<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title></title>

        <link rel="stylesheet" href="/css/bootstrap.min.css">
        <link rel="stylesheet" href="/css/font-awesome.min.css">
        <link rel="stylesheet" href="/css/highlight.dark.css">
        <link rel="stylesheet" href="/css/main.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="/">
                The title
                <small class="hidden-xs hidden-sm">
                    This is the default subtitle!
                </small>
            </a>

            
        </header>

        <main class="container">
            <div class="row">

                
                <section id="content" class="col-sm-12">
                    <h2 id="cart">Cart</h2>
<h3 id="create-the-cart">Create the Cart</h3>
<p><em>NOTE</em></p>
<ul>
<li>All calls to carts enpoint return a <em>Cart</em>. See <code>GET /api/v3/carts/{id}</code> for details.</li>
</ul>
<p>Create a new <em>Cart</em> is as easy as send a <code>POST</code> to the <code>/api/v3/carts</code> endpoint. The information needed to create a cart are divided in two groups: those related to the <em>Tickets</em> and those related to the <em>Customer</em>.</p>
<pre><code>POST /api/v3/carts

{
    "tickets":[
        {
            "product": {
                "id": 8216618
            },
            "quantity":2,
            "metadata":{"language":"es"}
        }
    ]
}</code></pre>
<p>Of course you can also add more items with a single call</p>
<pre><code>POST /api/v3/carts

{
    "tickets":[
        {
            "product": {
                "id": 8216618
            },
            "quantity": 2,
            "metadata":{"language":"es"}
        },
        {
            "product": {
                "id": 7372773
            },
            "quantity": 12
        }
    ]
}</code></pre>
<h4 id="add-info-to-a-cart">Add info to a cart</h4>
<p>Once a cart is create you can add information sending <code>PATCH</code> to the endpoint <code>/api/v3/carts/{id}</code>.</p>
<p><em>A call that add customer data to an existing cart</em></p>
<pre><code>PATCH /api/v3/carts/{id}

{
  "customer" : {
    "email": "guest136a@fakemail.com",
    "firstname": "Guest136a",
    "lastname": "surname136a",
    "country": {
      "id": 123
    }
  }
}</code></pre>
<p><em>NOTE</em></p>
<ul>
<li><code>email</code>, <code>firstname</code>, <code>lastname</code> and <code>country</code> are all mandatory.</li>
<li>For the list of available countries <a href="https://thack.musement.com/documentation#get--api-v3-countries.{_format}">see</a></li>
</ul>
<h4 id="updatechange-info-in-a-cart">Update/change info in a cart</h4>
<p>To completely replace the data in the cart you must use <code>PUT</code> verbs and pass the full new payload.</p>
<pre><code>PUT /api/v3/carts/1

{
    "tickets":[
      {
        "product": {
          "id": 8216618
        },
        "quantity":3,
        "metadata":{"language":"fr"}
      }     
    ],
    "customer" : {
      "email": "guest136a@fakemail.com",
      "firstname": "Guest136a",
      "lastname": "surname136a",
      "country": {
        "id": 123
    }
  }
}</code></pre>
<blockquote>
<p>The main difference between PUT and PATCH is that with the first you will update the model of the cart with the body you send, with the PATCH you will update just the field you sent in body. </p>
</blockquote>
<h4 id="retrive-the-cart">Retrive the cart</h4>
<h4><em>Request</em></h4>
<p><code>GET /api/v3/carts/{id}</code></p>
<pre><code>{
  "id": 1,
  "tickets": [
    {
      "product": {
        "id": "4488624",
        "type": "musement",
        "title": "Torre Eiffel: biglietti salta-la-coda con accesso sommità",
        "datetime": "2015-08-27T17:30:00+0000",
        "tourist_category": "Prezzo intero",
        "activity_name": "Ingresso",
        "event": {
          "id": 2700,
          "title": "Torre Eiffel: biglietti salta-la-coda con accesso sommità"
        },
        "image": "https://static1.musement.com/cover/0001/19/skip-the-line-tickets-to-the-eiffel-tower-with-summit-acc..."
      },
      "code": "BLU27-08-17-92138",
      "quantity": 1,
      "metadata": {},
      "status": "PENDING",
      "vouchers": []
    }
  ],
  "retail_price": {
    "currency": "EUR",
    "value": 26.6,
    "formatted_value": "€ 26.60"
  }
}</code></pre>
<h4 id="extra-info-needed-for-cart">Extra info needed for cart</h4>
<p>Once the you cart has items and customer information, depending on the items you have in the cart, some extra info might be needed to complete the purchase.</p>
<p>To retrieve these info you need to call <code>GET /api/v3/carts/{id}/form</code> </p>
<p>With this form you can retrieve all information needed for a successful booking, there are three big categories:</p>
<ul>
<li>Customer Data - Standard infor related to the customer</li>
<li>Extended Fields - Custom info related to the customer </li>
<li>Passenger Info - Info <em>for each</em> passanger</li>
</ul>
<p>Response:</p>
<pre><code>{
  "children": {
    "firstname": {
      "type": "text",
      "required": true,
      "label": "Name"
    },
    "lastname": {
      "type": "text",
      "required": true,
      "label": "Surname"
    },
    "email": {
      "children": {
        "email": {
          "type": "email",
          "required": true,
          "label": "Email Address"
        },
        "email_confirm": {
          "type": "email",
          "required": true,
          "label": "Confirm Email"
        }
      },
      "type": "repeated",
      "required": true,
      "label": "Email Address"
    },
    "customer_data": {
      "children": {
        "do_you_need_invoice": {
          "type": "checkbox",
          "required": false,
          "label": "Do you need an invoice?"
        },
        "birthdate": {
          "type": "date",
          "required": false,
          "label": "Date of birth"
        },
        "country": {
          "type": "entity",
          "required": true,
          "label": "Country"
        },
        "city": {
          "type": "text",
          "required": false,
          "label": "City"
        },
        "address": {
          "type": "text",
          "required": false,
          "label": "Address"
        },
        "zipcode": {
          "type": "text",
          "required": false,
          "label": "ZIP Code"
        },
        "mobile": {
          "type": "number",
          "required": false,
          "label": "Mobile #"
        },
        "id_number": {
          "type": "text",
          "required": false,
          "label": "Passport number"
        }
      },
      "type": "musement_user_customer_data",
      "required": true,
      "label": "Customer data"
    },
    "extended_fields": {
      "children": {
        "2700": {
          "children": {
            "159": {
              "children": {
                "phone_number": {
                  "type": "text",
                  "required": true,
                  "label": "Phone number"
                }
              },
              "type": "form",
              "required": true,
              "label": "text.profile.159"
            }
          },
          "type": "form",
          "required": true,
          "label": "text.profile.2700"
        }
      },
      "type": "form",
      "required": true,
      "label": "Extended fields"
    }
  }
}</code></pre>
<p>Just required fields are needed for a successful booking. With a response like the previous one you have to update your cart with this body:</p>
<pre><code>{
  "firstname": "Guest136a",
  "lastname": "surname136a",
  "email": "guest136a@fakemail.com",
  "customer_data": 
  {
    "country": {
      "id": 123
    }
  },
  "extended_fields": {
    "phone_number": 123
  }
}</code></pre>
                </section>

            </div>
        </main>

        <footer>
            <div class="container">
                <p class="text-muted">
                    website generated with <a href="http://couscous.io" title="Markdown website generator">Couscous</a>
                </p>
            </div>
        </footer>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="//yastatic.net/highlightjs/8.2/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
